<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repository Details - Cairn</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #0D1117;
            color: #c9d1d9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #58a6ff;
            text-decoration: none;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .header {
            margin-bottom: 30px;
        }

        .header h1 {
            color: #f0f6fc;
            margin-bottom: 10px;
            font-size: 24px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 20px;
        }

        .stat-card h2 {
            color: #f0f6fc;
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .contributor-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .contributor-card {
            background-color: #21262d;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .contributor-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .contributor-info {
            flex: 1;
        }

        .contributor-name {
            color: #58a6ff;
            text-decoration: none;
            font-weight: 600;
            display: block;
            margin-bottom: 5px;
        }

        .contributor-contributions {
            color: #8b949e;
            font-size: 12px;
        }

        .language-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .language-item {
            background-color: #21262d;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .language-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .language-name {
            color: #c9d1d9;
            font-size: 14px;
        }

        .language-percentage {
            color: #8b949e;
            font-size: 12px;
        }

        .file-list {
            background-color: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            overflow: hidden;
        }

        .file-item {
            padding: 12px 15px;
            border-bottom: 1px solid #30363d;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-name {
            color: #c9d1d9;
            font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
            font-size: 14px;
        }

        .file-owners {
            display: flex;
            gap: 8px;
        }

        .owner-tag {
            background-color: #21262d;
            border: 1px solid #30363d;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            color: #8b949e;
        }

        .owner-tag.primary {
            background-color: #1f6feb;
            border-color: #388bfd;
            color: #f0f6fc;
        }

        .search-box {
            width: 100%;
            padding: 8px 12px;
            background-color: #0D1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            color: #c9d1d9;
            margin-bottom: 15px;
        }

        .search-box:focus {
            outline: none;
            border-color: #58a6ff;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #8b949e;
        }

        .error {
            background-color: #3c1c1e;
            border: 1px solid #f85149;
            color: #f85149;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/repos" class="back-link">‚Üê Back to Repository Management</a>
        
        <div class="header">
            <h1 id="repo-title">Loading repository details...</h1>
        </div>

        <div id="error-message" class="error" style="display: none;"></div>

        <div id="loading" class="loading">Loading repository statistics...</div>

        <div id="content" style="display: none;">
            <div class="stats-grid">
                <div class="stat-card">
                    <h2>Contributors</h2>
                    <div id="contributors" class="contributor-list"></div>
                </div>

                <div class="stat-card">
                    <h2>Languages</h2>
                    <div id="languages" class="language-list"></div>
                </div>
            </div>

            <div class="stat-card">
                <h2>File Ownership</h2>
                <input type="text" id="file-search" class="search-box" placeholder="Search files...">
                <div id="files" class="file-list"></div>
            </div>
        </div>
    </div>

    <script>
        // Get repository details from URL
        const pathParts = window.location.pathname.split('/');
        const owner = pathParts[2];
        const repo = pathParts[3];

        // Language colors mapping
        const languageColors = {
            'Python': '#3572A5',
            'JavaScript': '#f1e05a',
            'TypeScript': '#2b7489',
            'HTML': '#e34c26',
            'CSS': '#563d7c',
            'Java': '#b07219',
            'C++': '#f34b7d',
            'Go': '#00ADD8',
            'Rust': '#dea584',
            'Ruby': '#701516',
            'PHP': '#4F5D95',
            'C#': '#178600',
            'Shell': '#89e051',
            'Swift': '#ffac45',
            'Kotlin': '#F18E33',
            'Scala': '#c22d40',
            'R': '#198CE7',
            'Dart': '#00B4AB',
            'Objective-C': '#438eff',
            'C': '#555555'
        };

        async function loadRepoStats() {
            try {
                const response = await fetch(`/api/repos/${owner}/${repo}/stats`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                renderRepoStats(data);
            } catch (error) {
                showError(`Failed to load repository statistics: ${error.message}`);
            }
        }

        function renderRepoStats(data) {
            // Update title
            document.getElementById('repo-title').textContent = `${data.owner}/${data.repo}`;

            // Render contributors
            const contributorsHtml = data.contributors.map(contributor => `
                <div class="contributor-card">
                    <img src="${contributor.avatar_url}" alt="${contributor.login}" class="contributor-avatar">
                    <div class="contributor-info">
                        <a href="${contributor.html_url}" target="_blank" class="contributor-name">${contributor.login}</a>
                        <span class="contributor-contributions">${contributor.contributions} contributions</span>
                    </div>
                </div>
            `).join('');
            document.getElementById('contributors').innerHTML = contributorsHtml;

            // Render languages
            const languagesHtml = data.languages.map(lang => `
                <div class="language-item">
                    <div class="language-color" style="background-color: ${languageColors[lang.name] || '#8b949e'}"></div>
                    <span class="language-name">${lang.name}</span>
                    <span class="language-percentage">${lang.percentage}%</span>
                </div>
            `).join('');
            document.getElementById('languages').innerHTML = languagesHtml;

            // Render file ownership
            renderFileOwnership(data.file_ownership);

            // Hide loading, show content
            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';
        }

        function renderFileOwnership(fileOwnership) {
            const filesHtml = Object.entries(fileOwnership)
                .sort((a, b) => b[1].last_modified.localeCompare(a[1].last_modified))
                .map(([filename, data]) => {
                    const authors = Object.entries(data.authors)
                        .sort((a, b) => b[1] - a[1]);
                    
                    const primaryAuthor = authors[0];
                    const otherAuthors = authors.slice(1);

                    return `
                        <div class="file-item" data-filename="${filename}">
                            <span class="file-name">${filename}</span>
                            <div class="file-owners">
                                <span class="owner-tag primary">${primaryAuthor[0]} (${primaryAuthor[1]} commits)</span>
                                ${otherAuthors.map(([author, commits]) => 
                                    `<span class="owner-tag">${author} (${commits})</span>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                }).join('');
            
            document.getElementById('files').innerHTML = filesHtml;
        }

        function showError(message) {
            const errorElement = document.getElementById('error-message');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            document.getElementById('loading').style.display = 'none';
        }

        // File search functionality
        document.getElementById('file-search').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const fileItems = document.querySelectorAll('.file-item');
            
            fileItems.forEach(item => {
                const filename = item.getAttribute('data-filename').toLowerCase();
                item.style.display = filename.includes(searchTerm) ? 'flex' : 'none';
            });
        });

        // Load repository statistics when page loads
        loadRepoStats();
    </script>
</body>
</html> 